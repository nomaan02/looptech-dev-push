{%- comment -%}
  SKU PARSER

  Parses LoopTech SKU format to extract product condition.

  SKU Format: BRAND-MODEL-CAPACITY-CONDITION-COLOR-SEQ
  Example: APPL-IPH15PM-256-NEW-BLK-001

  Input:
    sku - The variant SKU string

  Output Variables:
    sku_is_valid - Boolean
    sku_condition - String: 'NEW', 'REN', or 'UNKNOWN'
    sku_mode - String: 'brand-new', 'renewed', or 'unknown'
    sku_brand - String
    sku_model - String
    sku_capacity - String
    sku_color - String
    sku_sequence - String

  Usage:
    {%- render 'sku-parser', sku: variant.sku -%}
    {% if sku_mode == 'brand-new' %}...{% endif %}
{%- endcomment -%}

{%- liquid
  assign sku_is_valid = false
  assign sku_condition = 'UNKNOWN'
  assign sku_mode = 'unknown'
  assign sku_brand = ''
  assign sku_model = ''
  assign sku_capacity = ''
  assign sku_color = ''
  assign sku_sequence = ''

  if sku != blank and sku != nil and sku != ''
    assign sku_parts = sku | split: '-'
    assign parts_count = sku_parts | size

    if parts_count == 6
      assign sku_brand = sku_parts[0]
      assign sku_model = sku_parts[1]
      assign sku_capacity = sku_parts[2]
      assign sku_condition = sku_parts[3] | upcase
      assign sku_color = sku_parts[4]
      assign sku_sequence = sku_parts[5]

      if sku_condition == 'NEW'
        assign sku_is_valid = true
        assign sku_mode = 'brand-new'
      elsif sku_condition == 'REN'
        assign sku_is_valid = true
        assign sku_mode = 'renewed'
      elsif sku_condition == 'REFA' or sku_condition == 'REFB' or sku_condition == 'REFC'
        assign sku_is_valid = true
        assign sku_mode = 'renewed'
        assign sku_condition = 'REN'
      endif
    endif
  endif
-%}
