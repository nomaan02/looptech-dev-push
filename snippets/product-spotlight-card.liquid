{%- comment -%}
  Product card snippet - styled to match recently viewed products

  Usage: {% render 'product-spotlight-card', product: product, show_rating: true, show_starting_at: true, show_new_price: false, section_id: section.id %}

  Params:
  - product: Product object (required)
  - show_rating: show/hide ratings (optional, defaults to true)
  - show_starting_at: show/hide "Starting at" text (optional, defaults to true)
  - show_new_price: show/hide "New" price comparison (optional, defaults to false)
  - section_id: section ID for unique gradient IDs (required)
{%- endcomment -%}

{%- liquid
  # default show_rating to true if not specified
  unless show_rating == false
    assign show_rating = true
  endunless

  # default show_starting_at to true if not specified
  unless show_starting_at == false
    assign show_starting_at = true
  endunless

  # default show_new_price to false if not specified
  unless show_new_price == true
    assign show_new_price = false
  endunless
-%}

<article class="spotlight-product-card" data-product-id="{{ product.id }}">
  <a href="{{ product.url }}" class="spotlight-card-link" aria-label="View {{ product.title | escape }}">

    {%- # product image - 130x130px container, object-contain -%}
    <div class="spotlight-card-image-wrapper">
      {%- if product.featured_image -%}
        {%- assign product_alt = product.featured_image.alt | default: product.title | escape -%}
        {{ product.featured_image | image_url: width: 130, height: 130, crop: 'center' | image_tag:
          class: 'spotlight-card-image',
          loading: 'lazy'
        }}
      {%- else -%}
        {{ 'product-1' | placeholder_svg_tag: 'spotlight-card-image-placeholder' }}
      {%- endif -%}
    </div>

    {%- # color swatches - 12px circles with proper styling -%}
    <div class="spotlight-card-swatches">
      {%- assign color_option = null -%}
      {%- for option in product.options_with_values -%}
        {%- assign option_name_downcase = option.name | downcase -%}
        {%- if option_name_downcase == 'color' or option_name_downcase == 'colour' -%}
          {%- assign color_option = option -%}
          {%- break -%}
        {%- endif -%}
      {%- endfor -%}

      {%- if color_option != null -%}
        {%- assign max_swatches = 4 -%}
        {%- assign color_count = 0 -%}
        {%- for value in color_option.values limit: max_swatches -%}
          {%- assign color_count = color_count | plus: 1 -%}
          {%- assign color_downcase = value | downcase -%}
          {%- assign swatch_color = '#CCCCCC' -%}

          {%- if color_downcase contains 'black' -%}
            {%- assign swatch_color = '#000000' -%}
          {%- elsif color_downcase contains 'white' -%}
            {%- assign swatch_color = '#FFFFFF' -%}
          {%- elsif color_downcase contains 'silver' or color_downcase contains 'grey' or color_downcase contains 'gray' -%}
            {%- assign swatch_color = '#C0C0C0' -%}
          {%- elsif color_downcase contains 'purple' -%}
            {%- assign swatch_color = '#9D98FF' -%}
          {%- elsif color_downcase contains 'red' -%}
            {%- assign swatch_color = '#FF0C14' -%}
          {%- elsif color_downcase contains 'blue' -%}
            {%- assign swatch_color = '#0000FF' -%}
          {%- elsif color_downcase contains 'green' -%}
            {%- assign swatch_color = '#00FF00' -%}
          {%- elsif color_downcase contains 'yellow' or color_downcase contains 'gold' -%}
            {%- assign swatch_color = '#FFD700' -%}
          {%- elsif color_downcase contains 'pink' or color_downcase contains 'rose' -%}
            {%- assign swatch_color = '#FFC0CB' -%}
          {%- endif -%}

          <div class="spotlight-swatch {% if forloop.first %}spotlight-swatch-active{% endif %}"
               style="background-color: {{ swatch_color }}"
               title="{{ value | escape }}"
               aria-label="{{ value | escape }}"></div>
        {%- endfor -%}

        {%- assign total_colors = color_option.values.size -%}
        {%- if total_colors > max_swatches -%}
          {%- assign additional = total_colors | minus: max_swatches -%}
          <span class="spotlight-swatch-more">+{{ additional }}</span>
        {%- endif -%}
      {%- endif -%}
    </div>

    {%- # product title - 40px height, 2-line clamp -%}
    <div class="spotlight-card-title-wrapper">
      <h3 class="spotlight-card-title">{{ product.title }}</h3>
    </div>

    {%- # variant description - 19px height, 1-line clamp -%}
    <div class="spotlight-card-variant-wrapper">
      {%- if product.selected_or_first_available_variant.title != 'Default Title' -%}
        <p class="spotlight-card-variant">{{ product.selected_or_first_available_variant.title }}</p>
      {%- endif -%}
    </div>

    {%- # pricing section -%}
    <div class="spotlight-card-price">
      <span class="spotlight-price-current">{{ product.price | money }}</span>

      {%- if product.compare_at_price > product.price -%}
        <span class="spotlight-price-compare">{{ product.compare_at_price | money }}</span>
        <span class="spotlight-price-new-label"></span>
      {%- endif -%}
    </div>

  </a>
</article>
