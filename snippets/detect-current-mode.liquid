{%- comment -%}
  ============================================================================
  ⚠️  WARNING: DO NOT USE THIS SNIPPET WITH {% raw %}{%- render ... -%}{% endraw %}
  ============================================================================

  Liquid's `render` tag creates ISOLATED VARIABLE SCOPE.
  Variables set here (current_mode, has_url_mode) will NOT be accessible
  in the parent template!

  CORRECT USAGE:
  Copy the mode detection code below DIRECTLY into your section/template.

  INCORRECT USAGE (WILL NOT WORK):
    {%- render 'detect-current-mode' -%}
    {{ current_mode }}  ← This will be UNDEFINED!

  ============================================================================
  This file is kept for DOCUMENTATION PURPOSES ONLY.
  ============================================================================

  Mode Detection Logic:

  Priority:
    1. URL parameter (?mode=brand-new or ?mode=renewed)
    2. Default: 'brand-new'

  URL Parameters Accepted:
    ?mode=brand-new (preferred)
    ?mode=renewed (preferred)
    ?mode=new (legacy, mapped to brand-new)

  Copy this code into your section:
  --------------------------------
  {%- liquid
    assign current_mode = 'brand-new'
    assign has_url_mode = false
    assign url_string = request.url | downcase

    if url_string contains 'mode=renewed'
      assign current_mode = 'renewed'
      assign has_url_mode = true
    elsif url_string contains 'mode=brand-new'
      assign current_mode = 'brand-new'
      assign has_url_mode = true
    elsif url_string contains 'mode=new'
      assign current_mode = 'brand-new'
      assign has_url_mode = true
    endif
  -%}
  --------------------------------
{%- endcomment -%}

{%- comment -%}
  The actual mode detection code is included below for backwards compatibility
  with any code that might use `include` instead of `render` (deprecated but
  still works and DOES share variable scope).
{%- endcomment -%}
{%- liquid
  assign current_mode = 'brand-new'
  assign has_url_mode = false
  assign url_string = request.url | downcase

  if url_string contains 'mode=renewed'
    assign current_mode = 'renewed'
    assign has_url_mode = true
  elsif url_string contains 'mode=brand-new'
    assign current_mode = 'brand-new'
    assign has_url_mode = true
  elsif url_string contains 'mode=new'
    assign current_mode = 'brand-new'
    assign has_url_mode = true
  endif
-%}

{%- comment -%}
  NOTE: JavaScript removed from this snippet to prevent duplicate initialization.
  The mode-toggle.liquid section handles all localStorage sync and redirects.
  Having multiple scripts trying to redirect simultaneously caused race conditions.
{%- endcomment -%}
