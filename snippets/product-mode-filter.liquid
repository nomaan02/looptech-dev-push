{%- comment -%}
  PRODUCT MODE FILTER

  Determines if a product should be displayed based on current toggle mode.

  Input:
    product - Product object
    current_mode - Current toggle mode ('brand-new' or 'renewed')

  Output:
    show_product - Boolean
    product_mode - String: 'brand-new', 'renewed', or 'unknown'

  Logic Priority:
    1. Product tags (most reliable)
    2. SKU parsing (fallback)
    3. Unknown = show in both modes (fail-open)

  Usage:
    {%- render 'product-mode-filter', product: product, current_mode: current_mode -%}
    {% if show_product %}...{% endif %}
{%- endcomment -%}

{%- liquid
  assign show_product = false
  assign product_mode = 'unknown'

  # Primary: Check product tags
  if product.tags contains 'brand-new'
    assign product_mode = 'brand-new'
  elsif product.tags contains 'renewed'
    assign product_mode = 'renewed'
  endif

  # Fallback: Parse SKU if no tag found
  if product_mode == 'unknown'
    assign check_sku = product.selected_or_first_available_variant.sku
    if check_sku != blank
      render 'sku-parser', sku: check_sku
      if sku_is_valid
        assign product_mode = sku_mode
      endif
    endif
  endif

  # Determine visibility
  if product_mode == current_mode
    assign show_product = true
  elsif product_mode == 'unknown'
    assign show_product = true
  endif
-%}
