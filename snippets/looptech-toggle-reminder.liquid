{% comment %}
  LoopTech Toggle Reminder Bar

  Displays a reminder bar showing which product mode (Brand New / Renewed) the user is currently browsing.
  Allows switching between modes via toggle buttons.

  Parameters:
    - brand_new_text: Text to display when in Brand New mode
    - renewed_text: Text to display when in Renewed mode
    - current_mode: Current toggle mode from detect-current-mode ('brand-new' or 'renewed')

  Toggle Integration:
    - Reads initial state from current_mode parameter (server-rendered)
    - Clicking toggle redirects to same page with ?mode= parameter
    - localStorage sync handled by detect-current-mode snippet
{% endcomment %}

{% assign mode = current_mode | default: 'brand-new' %}

<div class="looptech-toggle-reminder" data-toggle-reminder data-current-mode="{{ mode }}">
  <div class="looptech-toggle-reminder__container">
    <p class="looptech-toggle-reminder__text" data-reminder-text>
      <span data-text-brand-new {% if mode != 'brand-new' %}style="display: none;"{% endif %}>
        {{ brand_new_text | default: 'You are currently browsing Brand New. Switch to Renewed, using the toggle.' }}
      </span>
      <span data-text-renewed {% if mode != 'renewed' %}style="display: none;"{% endif %}>
        {{ renewed_text | default: 'You are currently browsing Renewed. Switch to Brand New, using the toggle.' }}
      </span>
    </p>
    <div class="looptech-toggle-reminder__buttons">
      <button
        class="looptech-toggle-reminder__btn {% if mode == 'brand-new' %}looptech-toggle-reminder__btn--active{% endif %}"
        data-toggle-mode="brand-new"
        type="button"
        aria-pressed="{% if mode == 'brand-new' %}true{% else %}false{% endif %}"
      >
        Brand New
      </button>
      <button
        class="looptech-toggle-reminder__btn {% if mode == 'renewed' %}looptech-toggle-reminder__btn--active{% endif %}"
        data-toggle-mode="renewed"
        type="button"
        aria-pressed="{% if mode == 'renewed' %}true{% else %}false{% endif %}"
      >
        Renewed
      </button>
    </div>
  </div>
</div>

<style>
  .looptech-toggle-reminder {
    width: 100%;
    background-color: #F9FAFB;
    border-bottom: 1px solid #E5E7EB;
  }

  /* Background color variants based on mode */
  .looptech-toggle-reminder[data-current-mode="brand-new"] {
    background-color: #F0FDF4;
  }

  .looptech-toggle-reminder[data-current-mode="renewed"] {
    background-color: #EFF6FF;
  }

  .looptech-toggle-reminder__container {
    max-width: 1270px;
    margin: 0 auto;
    padding: 12px 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  @media (min-width: 768px) {
    .looptech-toggle-reminder__container {
      flex-direction: row;
      justify-content: space-between;
      padding: 12px 24px;
    }
  }

  .looptech-toggle-reminder__text {
    font-size: 13px;
    line-height: 1.5;
    color: #4A5565;
    margin: 0;
    text-align: center;
  }

  @media (min-width: 768px) {
    .looptech-toggle-reminder__text {
      text-align: left;
    }
  }

  .looptech-toggle-reminder__text strong {
    font-weight: 700;
    color: #0A0A0A;
  }

  .looptech-toggle-reminder__buttons {
    display: flex;
    gap: 8px;
  }

  .looptech-toggle-reminder__btn {
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    background-color: #E5E7EB;
    color: #6A7282;
  }

  .looptech-toggle-reminder__btn:hover {
    background-color: #D1D5DB;
  }

  .looptech-toggle-reminder__btn--active {
    background-color: #007BFF;
    color: #fff;
  }

  .looptech-toggle-reminder__btn--active:hover {
    background-color: #0056b3;
  }
</style>

<script>
  (function() {
    const STORAGE_KEY = 'looptech_mode';
    const reminderBar = document.querySelector('[data-toggle-reminder]');
    if (!reminderBar) return;

    const toggleButtons = reminderBar.querySelectorAll('[data-toggle-mode]');
    const textBrandNew = reminderBar.querySelector('[data-text-brand-new]');
    const textRenewed = reminderBar.querySelector('[data-text-renewed]');

    // Get current mode from data attribute (server-rendered)
    const currentMode = reminderBar.dataset.currentMode || 'brand-new';

    toggleButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        const newMode = this.dataset.toggleMode;

        // Don't do anything if clicking the already active mode
        if (newMode === currentMode) return;

        // Save to localStorage
        try {
          localStorage.setItem(STORAGE_KEY, newMode);
        } catch(e) {}

        // Redirect with new mode parameter
        const url = new URL(window.location.href);
        url.searchParams.set('mode', newMode);
        window.location.href = url.toString();
      });
    });

    // Visual update function (used if needed for dynamic updates)
    function updateModeVisual(mode) {
      reminderBar.dataset.currentMode = mode;

      toggleButtons.forEach(btn => {
        const isActive = btn.dataset.toggleMode === mode;
        btn.classList.toggle('looptech-toggle-reminder__btn--active', isActive);
        btn.setAttribute('aria-pressed', isActive);
      });

      if (textBrandNew && textRenewed) {
        textBrandNew.style.display = mode === 'brand-new' ? '' : 'none';
        textRenewed.style.display = mode === 'renewed' ? '' : 'none';
      }
    }
  })();
</script>
